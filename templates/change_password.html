<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تغيير كلمة المرور - متجر الأزياء</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <link href="/static/dashboard.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            {% include 'sidebar.html' %}

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 main-content">
                <!-- Header -->
                <div class="dashboard-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="h2 fw-bold"><i class="fas fa-key me-2"></i>تغيير كلمة المرور</h1>
                            <p class="text-muted mb-0">تحديث كلمة مرور حسابك</p>
                        </div>
                        <div class="btn-toolbar">
                            <a href="/" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-right me-2"></i>العودة للرئيسية
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show">
                                <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' }} me-2"></i>
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <!-- Change Password Form -->
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0"><i class="fas fa-user-shield me-2"></i>تحديث كلمة المرور</h5>
                            </div>
                            <div class="card-body">
                                <form method="POST" action="/change-password">
                                    <div class="mb-3">
                                        <label for="current_password" class="form-label fw-bold">كلمة المرور الحالية <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-light border-end-0">
                                                <i class="fas fa-lock text-muted"></i>
                                            </span>
                                            <input type="password" class="form-control border-start-0" id="current_password" 
                                                   name="current_password" placeholder="أدخل كلمة المرور الحالية" required>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="new_password" class="form-label fw-bold">كلمة المرور الجديدة <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-light border-end-0">
                                                <i class="fas fa-key text-muted"></i>
                                            </span>
                                            <input type="password" class="form-control border-start-0" id="new_password" 
                                                   name="new_password" placeholder="أدخل كلمة المرور الجديدة" required>
                                        </div>
                                        <div class="form-text">
                                            يجب أن تحتوي كلمة المرور على الأقل على 6 أحرف.
                                        </div>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <label for="confirm_password" class="form-label fw-bold">تأكيد كلمة المرور <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-light border-end-0">
                                                <i class="fas fa-check-circle text-muted"></i>
                                            </span>
                                            <input type="password" class="form-control border-start-0" id="confirm_password" 
                                                   name="confirm_password" placeholder="أعد إدخال كلمة المرور الجديدة" required>
                                        </div>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="fas fa-save me-2"></i>تغيير كلمة المرور
                                        </button>
                                        <a href="/" class="btn btn-outline-secondary">إلغاء</a>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Security Tips -->
                        <div class="card mt-4">
                            <div class="card-header bg-light">
                                <h6 class="card-title mb-0"><i class="fas fa-lightbulb me-2"></i>نصائح أمنية</h6>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled mb-0">
                                    <li class="mb-2"><i class="fas fa-check text-success me-2"></i>استخدم كلمة مرور قوية تحتوي على أحرف وأرقام ورموز</li>
                                    <li class="mb-2"><i class="fas fa-check text-success me-2"></i>لا تستخدم كلمة المرور نفسها في أكثر من موقع</li>
                                    <li class="mb-2"><i class="fas fa-check text-success me-2"></i>غير كلمة المرور بشكل دوري كل 3 أشهر</li>
                                    <li class="mb-0"><i class="fas fa-check text-success me-2"></i>لا تشارك كلمة المرور مع أي شخص</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            const newPassword = document.getElementById('new_password');
            const confirmPassword = document.getElementById('confirm_password');
            
            form.addEventListener('submit', function(e) {
                if (newPassword.value !== confirmPassword.value) {
                    e.preventDefault();
                    alert('❌ كلمة المرور غير متطابقة. يرجى التأكد من تطابق كلمتي المرور.');
                    confirmPassword.focus();
                    return false;
                }
                
                if (newPassword.value.length < 6) {
                    e.preventDefault();
                    alert('❌ كلمة المرور يجب أن تحتوي على الأقل على 6 أحرف.');
                    newPassword.focus();
                    return false;
                }
            });
            
            // Real-time password validation
            confirmPassword.addEventListener('input', function() {
                if (newPassword.value !== confirmPassword.value) {
                    confirmPassword.classList.add('is-invalid');
                    confirmPassword.classList.remove('is-valid');
                } else {
                    confirmPassword.classList.remove('is-invalid');
                    confirmPassword.classList.add('is-valid');
                }
            });
            
            newPassword.addEventListener('input', function() {
                if (newPassword.value.length >= 6) {
                    newPassword.classList.remove('is-invalid');
                    newPassword.classList.add('is-valid');
                } else {
                    newPassword.classList.add('is-invalid');
                    newPassword.classList.remove('is-valid');
                }
                
                // Also validate confirm password when new password changes
                if (confirmPassword.value && newPassword.value !== confirmPassword.value) {
                    confirmPassword.classList.add('is-invalid');
                    confirmPassword.classList.remove('is-valid');
                } else if (confirmPassword.value) {
                    confirmPassword.classList.remove('is-invalid');
                    confirmPassword.classList.add('is-valid');
                }
            });
        });
    </script>
</body>
</html>