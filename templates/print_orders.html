<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª - {{ status_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* ... existing styles remain exactly the same ... */
        @media print {
            .no-print { display: none !important; }
            body { 
                font-size: 9pt;
                font-family: 'Arial', sans-serif;
                margin: 0;
                padding: 0;
            }
            .container { 
                max-width: 100% !important;
                padding: 3px;
                margin: 0;
            }
            .order-section {
                margin-bottom: 8px;
                page-break-inside: avoid;
            }
            .table {
                font-size: 7pt;
            }
        }
        
        body { 
            font-family: 'Arial', sans-serif;
            background: white;
            color: black;
            line-height: 1.1;
        }
        
        .header-section {
            border-bottom: 2px solid #333;
            padding-bottom: 5px;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .store-info {
            text-align: center;
            margin-bottom: 8px;
        }
        
        .store-name {
            font-size: 14px;
            font-weight: bold;
            color: #333;
            margin: 0;
        }
        
        .store-contact {
            font-size: 8pt;
            color: #666;
            margin: 1px 0;
        }
        
        .order-section {
            margin-bottom: 10px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            background: #f9f9f9;
        }
        
        .order-header {
            background: #333;
            color: white;
            padding: 4px;
            border-radius: 3px;
            margin-bottom: 5px;
            font-size: 9pt;
        }
        
        .section-title {
            font-weight: bold;
            font-size: 9pt;
            margin-bottom: 3px;
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 2px;
        }
        
        .table thead th {
            background-color: #333 !important;
            color: white !important;
            border: 1px solid #333;
            padding: 3px;
            font-size: 7pt;
        }
        
        .table tbody td {
            border: 1px solid #ddd;
            padding: 3px;
            font-size: 7pt;
        }
        
        .total-section {
            background: #f8f9fa;
            padding: 4px;
            border: 1px solid #333;
            margin-top: 5px;
            font-size: 8pt;
        }
        
        .footer {
            text-align: center;
            margin-top: 10px;
            padding-top: 5px;
            border-top: 1px solid #333;
            font-size: 7pt;
            color: #666;
        }
        
        @media screen {
            .container {
                max-width: 800px;
                margin: 10px auto;
                padding: 10px;
                background: white;
                box-shadow: 0 0 5px rgba(0,0,0,0.1);
            }
        }
        
        .print-info {
            background: #e9ecef;
            padding: 4px;
            border-radius: 3px;
            margin-bottom: 8px;
            text-align: center;
            font-size: 8pt;
        }
        
        .compact-table {
            font-size: 7pt;
        }
        
        .compact-table td {
            padding: 2px;
        }
        
        .status-badge {
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 6pt;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status-pending { background: #fff3cd; color: #856404; }
        .status-confirmed { background: #d1ecf1; color: #0c5460; }
        .status-shipped { background: #cce7ff; color: #004085; }
        .status-delivered { background: #d4edda; color: #155724; }
        .status-cancelled { background: #f8d7da; color: #721c24; }

        /* Location Styles */
        .location-info {
            font-size: 6pt;
            color: #555;
        }
        
        .location-badge {
            background: #e3f2fd;
            color: #1565c0;
            padding: 1px 4px;
            border-radius: 2px;
            font-size: 6pt;
            font-weight: bold;
        }
        
        /* âœ… ADDED: Permission warning styles */
        .permission-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin: 20px 0;
        }

        /* âœ… ENHANCED: LARGER Barcode styles for print_orders - MATCHING INVOICE SIZES */
        .product-barcode {
            text-align: center;
            padding: 5px;  /* âœ… Increased from 3px to 5px */
            margin: 0 auto;
        }

        .product-barcode img {
            max-width: 220px;  /* âœ… Increased from 180px to 220px (matches invoice) */
            height: 60px;      /* âœ… Increased from 45px to 60px (matches invoice) */
            image-rendering: crisp-edges;
            image-rendering: pixelated;
            border: 1px solid #eee;
        }

        .barcode-text {
            font-family: 'Courier New', monospace;
            font-size: 7pt;    /* âœ… Matches invoice size */
            text-align: center;
            margin-top: 2px;
            font-weight: bold;
            color: #333;
            direction: ltr;
            background: #f8f9fa;
            padding: 2px;
            border-radius: 2px;
        }

        .barcode-column {
            width: 200px;      /* âœ… Increased from 190px to 200px (matches invoice) */
            text-align: center;
            vertical-align: middle !important;
        }

        /* âœ… ENHANCED: LARGER QR Code styles for print_orders - MATCHING INVOICE SIZES */
        .qr-column {
            width: 150px;       /* âœ… Increased from 90px to 150px (matches invoice) */
            text-align: center;
            vertical-align: middle !important;
        }

        .product-qr {
            text-align: center;
            padding: 5px;       /* âœ… Increased from 2px to 5px */
            margin: 0 auto;
        }

        .qr-image {
            width: 120px;       /* âœ… Increased from 70px to 120px (matches invoice) */
            height: 120px;      /* âœ… Increased from 70px to 120px (matches invoice) */
            image-rendering: crisp-edges;
            border: 1px solid #eee;
        }

        .qr-label {
            font-family: 'Arial', sans-serif;
            font-size: 8pt;     /* âœ… Increased from 6pt to 8pt (matches invoice) */
            text-align: center;
            margin-top: 3px;    /* âœ… Increased from 2px to 3px */
            font-weight: bold;
            color: #333;
            background: #f8f9fa;
            padding: 3px;       /* âœ… Increased from 2px to 3px */
            border-radius: 2px;
        }

        /* âœ… NEW: Enhanced layout for client and order information */
        .info-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            gap: 10px;
        }
        
        .client-info-section {
            flex: 1;
            text-align: right;
            background: #f8f9fa;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 8pt;
        }
        
        .order-info-section {
            flex: 1;
            text-align: center;
            background: #e9ecef;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 8pt;
        }
        
        .info-title {
            font-weight: bold;
            margin-bottom: 3px;
            color: #333;
            border-bottom: 1px solid #ccc;
            padding-bottom: 2px;
        }

        @media print {
            .product-barcode img {
                max-width: 200px;  /* âœ… Increased for print (matches invoice print size) */
                height: 55px;      /* âœ… Increased for print */
            }
            .qr-image {
                width: 110px;       /* âœ… Increased for print */
                height: 110px;      /* âœ… Increased for print */
            }
            .info-container {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Print Button - Only show if user has permission -->
        {% if session.get('permissions', {}).get('print_orders') or session.get('role') == 'admin' %}
        <div class="no-print mb-2 text-center">
            <button class="btn btn-primary btn-sm" onclick="window.print()">
                ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµÙØ­Ø©
            </button>
            <button class="btn btn-secondary btn-sm" onclick="window.close()">
                Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
            </button>
        </div>
        {% else %}
        <!-- Show permission warning if user doesn't have access -->
        <div class="permission-warning">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„:</strong> Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù….
        </div>
        {% endif %}

        <!-- Store Information -->
        <div class="store-info">
            <div class="store-name">LUXURIA FASHION</div>
            <div class="store-contact">
                ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª - {{ status_name }}
            </div>
        </div>

        <!-- Print Header -->
        <div class="header-section">
            <h5 style="margin: 2px 0;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h5>
            <h6 style="margin: 2px 0;">{{ status_name }}</h6>
            <div class="print-info">
                <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</strong> {{ orders|length }} Ø·Ù„Ø¨ | 
                <strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> {{ now.strftime('%Y-%m-%d') }}
            </div>
        </div>

        <!-- Orders List -->
        {% if orders and (session.get('permissions', {}).get('print_orders') or session.get('role') == 'admin') %}
            {% for order in orders %}
            <div class="order-section">
                <div class="order-header">
                    <strong>Ø§Ù„Ø·Ù„Ø¨ #{{ order.id }}</strong>
                </div>
                
                <!-- âœ… ENHANCED: New layout - Client info on RIGHT, Order info in MIDDLE -->
                <div class="info-container">
                    <!-- Client Information - RIGHT SIDE -->
                    <div class="client-info-section">
                        <div class="info-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                        <table class="compact-table">
                            <tr>
                                <td><strong>Ø§Ù„Ø§Ø³Ù…:</strong></td>
                                <td>{{ order.user_name }}</td>
                            </tr>
                            <tr>
                                <td><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong></td>
                                <td>{{ order.user_phone }}</td>
                            </tr>
                            <tr>
                                <td><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong></td>
                                <td>{{ order.user_address }}</td>
                            </tr>
                            {% if order.user_state or order.user_region %}
                            <tr>
                                <td><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong></td>
                                <td class="location-info">
                                    {% if order.user_state %}<span class="location-badge">{{ order.user_state }}</span>{% endif %}
                                    {% if order.user_region %}<span class="location-badge">{{ order.user_region }}</span>{% endif %}
                                </td>
                            </tr>
                            {% endif %}
                        </table>
                    </div>
                    
                    <!-- Order Information - MIDDLE -->
                    <div class="order-info-section">
                        <div class="info-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</div>
                        <table class="compact-table">
                            <tr>
                                <td><strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong></td>
                                <td>#{{ order.id }}</td>
                            </tr>
                            <tr>
                                <td><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong></td>
                                <td>{{ order.order_date[:10] }}</td>
                            </tr>
                            <tr>
                                <td><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong></td>
                                <td>
                                    {% if order.status in ['Ù…Ø¹Ù„Ù‚', 'pending'] %}
                                        <span class="status-badge status-pending">Ù…Ø¹Ù„Ù‚</span>
                                    {% elif order.status in ['Ù…Ø¤ÙƒØ¯', 'confirmed'] %}
                                        <span class="status-badge status-confirmed">Ù…Ø¤ÙƒØ¯</span>
                                    {% elif order.status in ['ØªÙ… Ø§Ù„Ø´Ø­Ù†', 'shipped'] %}
                                        <span class="status-badge status-shipped">ØªÙ… Ø§Ù„Ø´Ø­Ù†</span>
                                    {% elif order.status in ['ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„', 'delivered'] %}
                                        <span class="status-badge status-delivered">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
                                    {% else %}
                                        <span class="status-badge status-cancelled">Ù…Ù„ØºÙŠ</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</strong></td>
                                <td><strong>{{ "{:,.0f}".format(order.total_amount) }} SYP</strong></td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Order Items -->
                <table class="table table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th width="3%">#</th>
                            <th width="15%">Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th width="8%">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</th>
                            <th width="6%">Ø§Ù„Ù„ÙˆÙ†</th>
                            <th width="6%">Ø§Ù„Ù…Ù‚Ø§Ø³</th>
                            <th width="7%">Ø§Ù„Ø³Ø¹Ø±</th>
                            <th width="4%">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th width="8%">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                            <!-- âœ… ENHANCED: Larger Barcode + QR Code Columns -->
                            <th width="23%" class="barcode-column">Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th width="20%" class="qr-column">ÙƒÙˆØ¯ QR</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in order.items_with_details %}
                        <tr>
                            <td class="text-center">{{ loop.index }}</td>
                            <td><strong>{{ item.product_name }}</strong></td>
                            <td style="font-size: 8pt; font-weight: bold; color: #e31616; background: #f8f9fa; padding: 8px;">
                                {{ item.model_number }}
                            </td>
                            <td>{{ item.color or "---" }}</td>
                            <td>{{ item.size or "---" }}</td>
                            <td>{{ "{:,.0f}".format(item.price) }}</td>
                            <td>{{ item.quantity }}</td>
                            <td><strong>{{ "{:,.0f}".format(item.price * item.quantity) }}</strong></td>
                            
                            <!-- âœ… ENHANCED: Larger Barcode Column -->
                            <td class="barcode-column">
                                {% if item.barcode_data and item.barcode_image %}
                                <div class="product-barcode">
                                    <img src="{{ item.barcode_image }}" alt="Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬">
                                    <div class="barcode-text">{{ item.barcode_data }}</div>
                                </div>
                                {% else %}
                                <div class="text-center" style="font-size: 6pt; color: #999;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø§Ø±ÙƒÙˆØ¯</div>
                                {% endif %}
                            </td>
                            
                            <!-- âœ… ENHANCED: Larger QR Code Column -->
                            <td class="qr-column">
                                {% if item.qr_code_image %}
                                <div class="product-qr">
                                    <img src="{{ item.qr_code_image }}" alt="QR ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬" class="qr-image">
                                    <div class="qr-label">QR Code</div>
                                </div>
                                {% else %}
                                <div class="text-center" style="font-size: 6pt; color: #999;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ QR</div>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <!-- Order Total -->
                <div class="total-section">
                    <div class="row">
                        <div class="col-md-6 offset-md-6">
                            <table class="compact-table">
                                <tr>
                                    <td><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</strong></td>
                                    <td><strong>{{ "{:,.0f}".format(order.total_amount) }} SYP</strong></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
        <div class="text-center py-3">
            {% if not (session.get('permissions', {}).get('print_orders') or session.get('role') == 'admin') %}
            <div class="permission-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„:</strong> Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©.
            </div>
            {% else %}
            <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>
            {% endif %}
        </div>
        {% endif %}

        <!-- Footer -->
        <div class="footer">
            <p>ØªÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù…Ù† Ù†Ø¸Ø§Ù… LUXURIA FASHION | {{ now.strftime('%Y-%m-%d') }}</p>
            <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ {{ orders|length }} Ø·Ù„Ø¨ - {{ status_name }}</p>
        </div>
    </div>

    <script>
        // Auto-print when page loads - Only if user has permission
        window.onload = function() {
            const hasPrintPermission = {% if session.get('permissions', {}).get('print_orders') or session.get('role') == 'admin' %}true{% else %}false{% endif %};
            
            if (hasPrintPermission) {
                // Auto-print when the page loads
                // window.print();
            }
        };
    </script>
</body>
</html>